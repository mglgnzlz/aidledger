{% extends 'AidLedgerMainPage/baseTemplate.html' %} {% block sidebar %}
<h2>Donator Dashboard</h2>
<h3>GENERATE QR</h3>
<a href="" class="button"><i class="fa-solid fa-database"></i> Generate QR</a>
<h3>DONATION TRACKER</h3>
<a href="" class="button"><i class="fa-solid fa-file"></i> Donation Tracker</a>

{% endblock %} {% block content %}

<h1>GENERATE QR CODE</h1>

<div class="inputFields">
  <form action="{% url 'create_relief_good' %}" method="post">
    {% csrf_token %}
    <label for="rfgType">TYPE OF GOODS TO BE DONATED:</label>
    <input type="text" id="rfgType" name="rfgType" /><br /><br />
    <label for="rfgWeight">WEIGHT:</label>
    <input type="text" id="rfgWeight" name="rfgWeight" /><br /><br />
    <input type="submit" value="Generate and Download QR Code" />
  </form>
</div>

<!-- <div class="qrcodeSection">
  <h3 class="qrGen">QR CODE GENERATED</h3>
  {% if qr_code %}
  <img src="{{ qr_code_data_url }}" alt="QR Code">
  {% endif %}
</div> -->

<div class="rfgList">
  <h1>Relief Goods</h1>
  <table class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Donor</th>
        <th>Type of Good</th>
        <th>Weight</th>
        <th>Status</th>
        <th>Recipient</th>
      </tr>
    </thead>
    <tbody>
      {% for good in relief_goods %}
      <tr>
        <td>{{ good.id }}</td>
        <td>{{ good.donor }}</td>
        <td>{{ good.typeOfGood }}</td>
        <td>{{ good.weight }}</td>
        <td>{{ good.status }}</td>
        <td>{{ good.recipient }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var button = document.getElementById('downloadBtn'); // Corrected ID
    button.addEventListener('click', function(event) {
        event.preventDefault(); // Prevent the form from submitting normally
        var xhr = new XMLHttpRequest();
        xhr.open('GET', "{% url 'create_relief_good' %}", true); // Updated to use 'create_relief_good'
        xhr.responseType = 'blob';

        xhr.onload = function() {
            if (this.status === 200) {
                var blob = new Blob([this.response], { type: 'image/png' });
                var downloadUrl = URL.createObjectURL(blob);
                var a = document.createElement("a");
                a.href = downloadUrl;
                a.download = "qr_code.png";
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(downloadUrl);
            }
        };

        xhr.send();
    });
});


</script>

{% endblock %}
